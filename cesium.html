<DOCTYPE html>
    <head>
      <title>Hello Cesium!</title>
      <script src="Build/Cesium/Cesium.js"></script>
      <!-- uploadData Javascript -->
      <script src="js/assetCreation.js"></script>
      <style>
          @import url(Build/Cesium/Widgets/widgets.css);
          html, body, #cesiumContainer {
              width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;
          }
               .toolbar-left {
                display: block;
                position: absolute;
                top: 5px;
                left: 5px;
            }
      </style>
    
    
      
    </head>
    <body>
      <div id="cesiumContainer"></div>
    </body>  
      <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"></script> 
    
      <script>


      "use strict";
      Cesium.Ion.defaultAccessToken ='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI3NmQ2NmVmNy0zZGY4LTQ1ZDAtYmUwOC03MjkzM2JjNzQ2OTQiLCJpZCI6MTU2NjMsInNjb3BlcyI6WyJhc3IiLCJnYyJdLCJpYXQiOjE1Njg1MjQwNTl9.siDvMt3fH91XzE39FU_xqVrx-i6M1wWOBl_2vCrY6Xo';
    
    Cesium.Ion.defaultAccessToken ='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI3NmQ2NmVmNy0zZGY4LTQ1ZDAtYmUwOC03MjkzM2JjNzQ2OTQiLCJpZCI6MTU2NjMsInNjb3BlcyI6WyJhc3IiLCJnYyJdLCJpYXQiOjE1Njg1MjQwNTl9.siDvMt3fH91XzE39FU_xqVrx-i6M1wWOBl_2vCrY6Xo';
    
    let imageryProviders = Cesium.createDefaultImageryProviderViewModels();
    let selectedImageryProviderIndex = 7;  // MapBox Street is 5th in the list.
    
    let viewer = new Cesium.Viewer('cesiumContainer', {
        imageryProviderViewModels: imageryProviders,
        selectedImageryProviderViewModel: imageryProviders[selectedImageryProviderIndex]
    });
    
    
    // only load the layer when the cesium basemap has been created
    document.addEventListener('DOMContentLoaded', function() {
       loadVectorLayer();
    }, false);
    
     
     </script>
    
    
    <script>
    "use strict";
    
    

    function getStrokeColor(conditionDescription) {
  switch (conditionDescription) {
    case 'Element is in very good condition':
      return Cesium.Color.GREEN;
    case 'Some aesthetic defects, needs minor repair':
      return Cesium.Color.YELLOW;
    case 'Functional degradation of some parts, needs maintenance':
      return Cesium.Color.ORANGE;
    case 'Not working and maintenance must be done as soon as reasonably possible':
      return Cesium.Color.RED;
    case 'Not working and needs immediate, urgent maintenance':
      return Cesium.Color.VIOLET;
    default:
      return Cesium.Color.BLUE;
  }
}

function loadVectorLayer() {
  fetchUserId()
    .then((userId) => {
      let serviceUrl = document.location.origin + "/api/userAssets/" + userId;

      fetch(serviceUrl)
        .then((response) => response.json())
        .then((geoJSONData) => {
          console.log("GeoJSON data:", geoJSONData);

          let dataSource = new Cesium.CustomDataSource("Assets");
          viewer.dataSources.add(dataSource);

          geoJSONData[0].features.forEach((feature) => {
            const longitude = feature.geometry.coordinates[0];
            const latitude = feature.geometry.coordinates[1];
            const condition = feature.properties.condition_description;
            const color = getStrokeColor(condition);

            viewer.entities.add({
            position: Cesium.Cartesian3.fromDegrees(longitude, latitude),
            point: {
                pixelSize: 10,
                color: color,
                outlineColor: Cesium.Color.BLACK,
                outlineWidth: 1,
            },
            name: feature.properties.asset_name,
            });
        });

          viewer.flyTo(dataSource);
        })
        .catch((error) => {
          console.error("Error fetching GeoJSON data:", error);
        });
    })
    .catch((error) => {
      console.error("Error fetching user ID:", error);
    });
}


    
    
    </script>
    
      
    
    
    </html>